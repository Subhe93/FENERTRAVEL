# ุฅุตูุงุญ ูุดููุฉ ุฅุนุงุฏุฉ ุงูุชูุฌูู ุนูุฏ Refresh ุงูุตูุญุฉ

## ุงููุดููุฉ ุงูุฃุตููุฉ โ

ุนูุฏ ุนูู refresh ูุฃู ุตูุญุฉ ูู ุงูุชุทุจูู:
1. **ูุชู ุงูุชูุฌูู ูุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู** ุจุณุจุจ ููุฏุงู ุญุงูุฉ ุงููุตุงุฏูุฉ ูุคูุชุงู
2. **ุซู ุงูุชูุฌูู ููุตูุญุฉ ุงูุฑุฆูุณูุฉ** ุจุฏูุงู ูู ุงูุนูุฏุฉ ููุตูุญุฉ ุงูุฃุตููุฉ
3. **ููุฏุงู ุงูุณูุงู** ูุงูุญุงุฌุฉ ููุชููู ูุฑุฉ ุฃุฎุฑู ููุตูุญุฉ ุงููุทููุจุฉ

## ุงูุณุจุจ ุงูุฌุฐุฑู ๐

ุงููุดููุฉ ูุงูุช ุชุญุฏุซ ุจุณุจุจ:
1. **ุชุฃุฎูุฑ ูู ุงูุชุญูู ูู ุงููุตุงุฏูุฉ**: `AuthContext` ูุญุชุงุฌ ููุช ููุชุญูู ูู ุตุญุฉ ุงูู token
2. **ุฅุนุงุฏุฉ ุชูุฌูู ูุจูุฑุฉ**: `ProtectedRoute` ูุงู ูุนูุฏ ุงูุชูุฌูู ููุฑุงู ุฏูู ุงูุชุธุงุฑ ุงูุชูุงุก ุงูุชุญูู
3. **ุนุฏู ุญูุธ ุงููุณุงุฑ ุงูุฃุตูู**: ูู ููู ููุงู ุขููุฉ ูุญูุธ ุงููุณุงุฑ ุนูุฏ ุงูู refresh

## ุงูุญู ุงููุทุจู ๐ง

### 1. ุชุญุณูู ProtectedRoute โ

```tsx
// ุฅุถุงูุฉ ุญุงูุฉ ุงูุชุธุงุฑ ููุชุญูู ูู ุงููุตุงุฏูุฉ
if (isLoading) {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <div className="text-center">
        <Loader2 className="w-12 h-12 text-blue-600 mx-auto mb-4 animate-spin" />
        <h2 className="text-lg font-semibold text-gray-900 mb-2">ุฌุงุฑู ุงูุชุญูู ูู ุตุญุฉ ุงูุฌูุณุฉ...</h2>
        <p className="text-gray-600">ูุฑุฌู ุงูุงูุชุธุงุฑ</p>
      </div>
    </div>
  );
}

// ุฅุนุงุฏุฉ ุงูุชูุฌูู ููุท ุจุนุฏ ุงูุชูุงุก ุงูุชุญูู
if (!isAuthenticated) {
  return <Navigate to="/login" state={{ from: location }} replace />;
}
```

### 2. ุชุญุณูู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู โ

```tsx
// ุงูุชุธุงุฑ ุงูุชูุงุก ุงูุชุญูู ูู ุงููุตุงุฏูุฉ
if (authLoading) {
  return <LoadingScreen />;
}

// ุฅุนุงุฏุฉ ุงูุชูุฌูู ุงูุฐููุฉ ููุตูุญุฉ ุงููุทููุจุฉ
if (isAuthenticated) {
  const stateFrom = (location.state as { from?: { pathname: string } })?.from?.pathname;
  const savedPath = getSavedPath();
  const redirectTo = stateFrom || savedPath || '/';
  
  if (savedPath) {
    clearSavedPath();
  }
  
  return <Navigate to={redirectTo} replace />;
}
```

### 3. ุฅุถุงูุฉ useReturnPath Hook โ

```tsx
export const useReturnPath = () => {
  const location = useLocation();

  // ุญูุธ ุงููุณุงุฑ ุงูุญุงูู ุชููุงุฆูุงู
  useEffect(() => {
    const ignoredPaths = ['/login', '/track', '/tracking'];
    
    if (!ignoredPaths.some(path => location.pathname.startsWith(path))) {
      sessionStorage.setItem(RETURN_PATH_KEY, location.pathname + location.search);
    }
  }, [location]);

  return {
    getSavedPath: () => sessionStorage.getItem(RETURN_PATH_KEY),
    clearSavedPath: () => sessionStorage.removeItem(RETURN_PATH_KEY)
  };
};
```

### 4. ุฅุถุงูุฉ ProtectedPageWrapper โ

```tsx
const ProtectedPageWrapper = ({ children }: ProtectedPageWrapperProps) => {
  // ุงุณุชุฎุฏุงู ุงูู hook ูุญูุธ ุงููุณุงุฑ ุชููุงุฆูุงู
  useReturnPath();
  
  return <>{children}</>;
};
```

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ๐

### 1. ุญูุธ ุงููุณุงุฑ ุงูุชููุงุฆู ๐พ
- **ุญูุธ ูู sessionStorage**: ูุญูุธ ุงููุณุงุฑ ุงูุญุงูู ุชููุงุฆูุงู
- **ุชุฌุงูู ุงูุตูุญุงุช ุงูุนุงูุฉ**: ูุง ูุญูุธ ุตูุญุงุช ูุซู `/login`, `/track`
- **ุชุถููู ุงููุนุงููุงุช**: ูุญูุธ ุงููุณุงุฑ ูุน query parameters

### 2. ุฅุนุงุฏุฉ ุงูุชูุฌูู ุงูุฐููุฉ ๐ง
- **ุฃููููุงุช ูุชุนุฏุฏุฉ**: state > savedPath > homepage
- **ูุณุญ ุชููุงุฆู**: ููุธู ุงููุณุงุฑ ุงููุญููุธ ุจุนุฏ ุงูุงุณุชุฎุฏุงู
- **ุฏุนู ูููุนุงููุงุช**: ูุนูุฏ ุงูุชูุฌูู ูุน ุฌููุน ุงููุนุงููุงุช

### 3. ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ ๐ค
- **ุญุงูุงุช ุชุญููู ูุงุถุญุฉ**: ุฑุณุงุฆู ูููุฏุฉ ุฃุซูุงุก ุงูุชุญูู
- **ุนุฏู ุงููุทุงุน**: ูุง ูุฑู ุงููุณุชุฎุฏู ุตูุญุฉ ุชุณุฌูู ุงูุฏุฎูู ุฅูุง ุนูุฏ ุงูุญุงุฌุฉ
- **ุงุณุชูุฑุงุฑูุฉ ุงูุณูุงู**: ูุนูุฏ ููุตูุญุฉ ุงูุฃุตููุฉ ุจุฏูู ููุฏุงู

## ุงูุตูุญุงุช ุงููุญููุฉ ุงููุญุฏูุซุฉ ๐

ุชู ุชุทุจูู ุงูุญู ุนูู:
- โ **ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ** (`/`)
- โ **ุชูุงุตูู ุงูุดุญูุฉ** (`/shipment/:id`)
- โ **ุชุนุฏูู ุงูุดุญูุฉ** (`/shipment/:id/edit`)
- โ **ุตูุญุฉ ุงููุงุชูุฑุฉ** (`/invoice/:id`)
- โ **ุตูุญุฉ ูุงุชูุฑุฉ ุงูุทุฑูู** (`/waybill/:id`)

## ุณููุงุฑูููุงุช ุงูุงุฎุชุจุงุฑ ๐งช

### 1. Refresh ูู ุตูุญุฉ ุดุญูุฉ โ
```
ูุจู: /shipment/123 โ refresh โ /login โ /
ุจุนุฏ: /shipment/123 โ refresh โ loading โ /shipment/123
```

### 2. Refresh ูู ุตูุญุฉ ุชุนุฏูู โ
```
ูุจู: /shipment/123/edit โ refresh โ /login โ /
ุจุนุฏ: /shipment/123/edit โ refresh โ loading โ /shipment/123/edit
```

### 3. Refresh ูู ุตูุญุฉ ูุงุชูุฑุฉ โ
```
ูุจู: /invoice/123 โ refresh โ /login โ /
ุจุนุฏ: /invoice/123 โ refresh โ loading โ /invoice/123
```

### 4. ุงูุชูุงุก ุงูุฌูุณุฉ โ
```
ุนูุฏ ุงูุชูุงุก ุงูุฌูุณุฉ: /shipment/123 โ /login โ (ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู) โ /shipment/123
```

## ุงูุชุญุณููุงุช ุงูุชูููุฉ โ๏ธ

### 1. ุฅุฏุงุฑุฉ ุงูุญุงูุฉ ุงููุญุณูุฉ
- **ุงูุชุธุงุฑ ุงูุชุญูู**: ูุง ุฅุนุงุฏุฉ ุชูุฌูู ูุจูุฑุฉ
- **ุญูุธ ุฐูู**: ูุญูุธ ุงููุณุงุฑ ููุท ููุตูุญุงุช ุงูููุงุณุจุฉ
- **ุชูุธูู ุชููุงุฆู**: ููุธู ุงูุจูุงูุงุช ุงููุญููุธุฉ ุนูุฏ ุนุฏู ุงูุญุงุฌุฉ

### 2. ุฃุฏุงุก ูุญุณู
- **sessionStorage**: ุฃุณุฑุน ูู localStorage ููุจูุงูุงุช ุงููุคูุชุฉ
- **ุชุญุฏูุซ ุชููุงุฆู**: ูุญูุธ ุงููุณุงุฑ ุนูุฏ ูู ุชููู
- **ุฐุงูุฑุฉ ููุฎูุถุฉ**: ููุธู ุงูุจูุงูุงุช ุบูุฑ ุงููุณุชุฎุฏูุฉ

### 3. ููุซูููุฉ ุนุงููุฉ
- **ูุนุงูุฌุฉ ุดุงููุฉ**: ูุชุนุงูู ูุน ุฌููุน ุญุงูุงุช ุงูุฎุทุฃ
- **fallback ุขูู**: ูุนูุฏ ููุตูุญุฉ ุงูุฑุฆูุณูุฉ ุนูุฏ ูุดู ุฃู ุดูุก
- **ุชุณุฌูู ูุงุถุญ**: ุฑุณุงุฆู ูููุฏุฉ ููุชุดุฎูุต

## ุงูููุงุฆุฏ ุงููุญููุฉ ๐ช

### 1. ุชุฌุฑุจุฉ ูุณุชุฎุฏู ููุชุงุฒุฉ
- โ **ูุง ุงููุทุงุน ูู ุงูุชุตูุญ**: ูุนูุฏ ููุตูุญุฉ ุงูุฃุตููุฉ ุฏุงุฆูุงู
- โ **ุญุงูุงุช ุชุญููู ูุงุถุญุฉ**: ูุนุฑู ุงููุณุชุฎุฏู ูุง ูุญุฏุซ
- โ **ุณุฑุนุฉ ูู ุงูุชููู**: ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุงูุชููู

### 2. ููุซูููุฉ ุงููุธุงู
- โ **ููุงููุฉ ููู refresh**: ูุนูู ุญุชู ูุน ุชุญุฏูุซ ุงูุตูุญุฉ
- โ **ุญูุธ ุงูุณูุงู**: ูุง ููุฏุงู ููููุงู ุงูุญุงูู
- โ **ุฃูุงู ูุญุณู**: ูุง ุชุณุฑุจ ูููุณุงุฑุงุช ุงูุญุณุงุณุฉ

### 3. ุณูููุฉ ุงูุตูุงูุฉ
- โ **ููุฏ ููุญุฏ**: ููุณ ุงูุขููุฉ ุนุจุฑ ุฌููุน ุงูุตูุญุงุช
- โ **ูุงุจููุฉ ุงูุชูุณุน**: ุณูู ุฅุถุงูุฉ ุตูุญุงุช ุฌุฏูุฏุฉ
- โ **ุชุดุฎูุต ุณูู**: ุฑุณุงุฆู ูุงุถุญุฉ ูู ูุญุฏุฉ ุงูุชุญูู

## ุงูุงุณุชุฎุฏุงู ุงูุขู ๐ฑ

ุงูุขู ูููู ูููุณุชุฎุฏููู:
- โ **ุนูู refresh ูุฃู ุตูุญุฉ** ูุงูุนูุฏุฉ ุฅูููุง ูุจุงุดุฑุฉ
- โ **ุฅุบูุงู ููุชุญ ุงูุชุจููุจ** ุฏูู ููุฏุงู ุงูููุงู
- โ **ุชุณุฌูู ุฏุฎูู ุฌุฏูุฏ** ูุงูุนูุฏุฉ ููุตูุญุฉ ุงููุทููุจุฉ
- โ **ุงูุชููู ุจุซูุฉ** ุฏูู ุฎูู ูู ููุฏุงู ุงูุณูุงู

## ููุงุญุธุงุช ูููุทูุฑูู ๐จโ๐ป

### ุฅุถุงูุฉ ุตูุญุฉ ุฌุฏูุฏุฉ ูุญููุฉ:
```tsx
<Route path="/new-page" element={
  <ProtectedRoute>
    <ProtectedPageWrapper>
      <Layout>
        <NewPage />
      </Layout>
    </ProtectedPageWrapper>
  </ProtectedRoute>
} />
```

### ุงุณุชุฎุฏุงู ุงูู hook ูู ููููุงุช ุฃุฎุฑู:
```tsx
const { getSavedPath, clearSavedPath } = useReturnPath();
```

ูุฐุง ุงูุฅุตูุงุญ ูุญู ูุดููุฉ ูููุฉ ูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ููุฌุนู ุงูุชุทุจูู ุฃูุซุฑ ุงุญุชุฑุงููุฉ ูููุซูููุฉ! ๐
