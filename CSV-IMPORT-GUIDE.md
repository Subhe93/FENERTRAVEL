# دليل استيراد ملفات CSV

هذا الدليل يوضح كيفية استيراد بيانات الشحنات من ملفات CSV إلى قاعدة البيانات.

## المتطلبات

- Node.js وYarn مثبتان
- قاعدة البيانات PostgreSQL تعمل
- متغير البيئة `DATABASE_URL` مُعرَّف بشكل صحيح

## خطوات الاستيراد

### 1. تحضير قاعدة البيانات

قبل استيراد البيانات، يجب تحضير قاعدة البيانات بالبيانات الأساسية:

```bash
yarn db:prepare-import
```

هذا الأمر سيقوم بـ:
- إنشاء البلدان الأساسية (سوريا، ألمانيا، سويسرا، إلخ)
- إنشاء حالات الشحنة الأساسية (قيد المراجعة، في الطريق، تم التسليم، إلخ)
- إنشاء الفروع الأساسية
- إنشاء المستخدمين الأساسيين

### 2. وضع ملف CSV

تأكد من أن ملف CSV موجود في المجلد الجذر للمشروع باسم `shipment-export-1755098092.csv`

### 3. تشغيل عملية الاستيراد

```bash
yarn db:import-csv
```

## هيكل ملف CSV المتوقع

يجب أن يحتوي ملف CSV على الأعمدة التالية:

- `ShipmentID`: معرف الشحنة
- `Shipment Title`: عنوان الشحنة (رقم الشحنة)
- `Shipper Name`: اسم المرسل
- `Phone Number`: رقم هاتف المرسل
- `Shipper Address`: عنوان المرسل
- `Shipper Email`: بريد المرسل الإلكتروني
- `Receiver Name`: اسم المستلم
- `Receiver Address`: عنوان المستلم
- `Receiver Email`: بريد المستلم الإلكتروني
- `Origin`: بلد المنشأ
- `Destination`: بلد الوجهة
- `Pickup Date`: تاريخ الاستلام
- `Expected Delivery Date`: تاريخ التسليم المتوقع
- `Shipment Status`: حالة الشحنة
- `Weight`: الوزن
- `Packages`: عدد الطرود
- `Product`: وصف المنتج
- `Payment Mode`: طريقة الدفع
- `Comments`: ملاحظات

## الميزات

### التعامل مع البيانات المكررة
- يتحقق السكريبت من وجود الشحنة مسبقاً باستخدام رقم الشحنة
- يتخطى الشحنات الموجودة مسبقاً

### إنشاء البيانات المرجعية تلقائياً
- ينشئ البلدان الجديدة تلقائياً
- يربط الشحنات بالبيانات الأساسية المناسبة

### تحويل أنواع البيانات
- يحول طرق الدفع من النص العربي إلى القيم المناسبة
- يحول التواريخ إلى الصيغة الصحيحة
- يتعامل مع الأرقام العشرية والفواصل

### معالجة الأخطاء
- يعرض إحصائيات مفصلة عن عملية الاستيراد
- يسجل الأخطاء مع تفاصيل كل شحنة فاشلة
- يستمر في الاستيراد حتى لو فشلت بعض السجلات

## مثال على الاستخدام الكامل

```bash
# 1. تحضير قاعدة البيانات
yarn db:prepare-import

# 2. استيراد البيانات
yarn db:import-csv

# 3. فتح Prisma Studio لمراجعة البيانات (اختياري)
yarn db:studio
```

## استكشاف الأخطاء

### خطأ في الاتصال بقاعدة البيانات
تأكد من:
- قاعدة البيانات PostgreSQL تعمل
- متغير `DATABASE_URL` صحيح
- المستخدم لديه صلاحيات الكتابة

### ملف CSV غير موجود
تأكد من:
- الملف موجود في المجلد الجذر
- اسم الملف صحيح: `shipment-export-1755098092.csv`

### أخطاء في البيانات
- راجع رسائل الخطأ في الكونسول
- تأكد من صحة تنسيق التواريخ
- تأكد من وجود البيانات الأساسية المطلوبة

## الملاحظات

- عملية الاستيراد قد تستغرق وقتاً طويلاً للملفات الكبيرة
- يُنصح بعمل نسخة احتياطية من قاعدة البيانات قبل الاستيراد
- يمكن تشغيل عملية الاستيراد عدة مرات دون مشاكل (تتخطى المكررات)

## الدعم

في حالة وجود مشاكل، راجع:
1. رسائل الخطأ في الكونسول
2. ملفات السجل
3. إعدادات قاعدة البيانات
